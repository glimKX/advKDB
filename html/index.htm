<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<link rel="stylesheet" href="css/selectPure.css">
<style>
textarea{
		display: block;
		margin-left: auto;
		margin-right: auto;
	}
</style>
<body>

<!-- Navigation -->
<nav class="w3-bar w3-black">
  <a href="#home" class="w3-button w3-bar-item">Home</a>
  <a href="#band" class="w3-button w3-bar-item"></a>
  <a href="#tour" class="w3-button w3-bar-item"></a>
  <a href="#contact" class="w3-button w3-bar-item"></a>
</nav>

<!-- Slide Show -->
<section>
</section>
<!-- Band Description -->
<section class="w3-container w3-center w3-content" style="max-width:600px">
  <h2 class="w3-wide">WebSocket</h2>
  <p class="w3-opacity"><i>Tickerplant</i></p>
 	<form action="">
		<input type="button"        value="connect"   onclick="connect()"    >
		<input type="text"   		id="x" 			  placeholder="q)"       >
		<input type="submit"        value="send"      onclick="return send()">
		<input type="button"        value="close"     onclick="ws.close()"   >
	</form>
	<span class="sym"></span>
</section>
<section>
	
	<textarea id="out" rows=25 cols=70 display=block margin-left=auto margin-right=20px></textarea>
</section>

<section class="w3-row-padding w3-center w3-light-grey">
	<p>Powered 32bit Q kdb</p>
  <article class="w3-third">
  </article>
</section>

<!-- Footer -->
<footer class="w3-container w3-padding-64 w3-center w3-black w3-xlarge">
  <a href="#"><i class="fa fa-facebook-official"></i></a>
  <a href="#"><i class="fa fa-pinterest-p"></i></a>
  <a href="#"><i class="fa fa-twitter"></i></a>
  <a href="#"><i class="fa fa-flickr"></i></a>
  <a href="#"><i class="fa fa-linkedin"></i></a>
  <p class="w3-medium">
  Powered by <a href="https://www.w3schools.com/w3css/default.asp" target="_blank">w3.css</a>
  </p>
</footer>

<script src="./dist/bundle.min.js"></script>
<script>
var myIndex = 0;
var ws,out=document.getElementById("out");
var sym;
var wsTmp, wsJsonObj;
function connect()
{if ("WebSocket" in window)
 {var l = window.location;ws = new WebSocket("ws://" + (l.hostname ? l.hostname : "localhost") + ":" + (l.port ? l.port : "5030") + "/"); 
  out.value="connecting..." ;
  ws.onopen=function(e){out.value="connected";queryForSym();} 
  ws.onclose=function(e){out.value="disconnected";}
  ws.onmessage=function(e){
	  wsTmp=e.data;
	  wsJsonObj=JSON.parse(wsTmp);
	  if (wsJsonObj.func == "sourceForSym"){parseForSym(wsJsonObj.output)}
	  else {out.value=e.data}
  }
  ws.onerror=function(e){out.value=e.data;}
 }else alert("WebSockets not supported on your browser.");
}
function send()
{x=document.getElementById("x");
 v=x.value;
 ws.send(v);
 out.value="sent "+v;
 return false;
}
function queryForSym()
{
  query="sourceForSym[]";
  ws.send(query);
  return false;
}
function parseForSym(x)
{
 x=x.split(" ");
 for (i in x){
	 myOptions[i]={
		 label:x[i],
		 value:x[i],
	 }
 }
 var instance = new SelectPure(".sym",
	{
	options:myOptions,
	}
 );
}
var myOptions = [];

</script>

</body>
</html>
